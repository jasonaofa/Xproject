# 依赖文件分析功能说明

## 功能概述

"增加依赖文件"功能可以自动分析选中的资源文件，找到所有相关的依赖文件（包括meta文件），并将它们添加到上传列表中。

## 功能特点

### 1. 智能依赖分析
- 自动扫描SVN仓库目录中的所有meta文件，建立GUID映射
- 分析资源文件中的GUID引用，找到所有依赖关系
- 支持Unity常见的资源格式：.prefab, .mat, .controller, .anim, .asset, .unity, .fbx, .png, .jpg, .jpeg, .tga, .psd

### 2. Meta文件自动包含
- **自动添加原始文件的meta文件**：当分析资源文件时，会自动包含对应的.meta文件
- **自动添加依赖文件的meta文件**：当找到依赖文件时，也会自动包含其对应的.meta文件
- **双向检测**：如果拖入的是meta文件，也会自动包含对应的资源文件

### 3. 完整的依赖链分析
- 递归分析依赖关系，确保所有相关文件都被包含
- 跳过Unity内置资源和系统资源，避免不必要的文件
- 提供详细的缺失依赖报告

## 使用方法

1. **选择文件**：将要分析的资源文件拖拽到上传列表或使用"选择文件"按钮
2. **设置SVN路径**：确保SVN仓库路径已正确设置
3. **点击按钮**：点击"增加依赖文件"按钮开始分析
4. **确认添加**：查看分析结果，确认要添加的依赖文件
5. **完成**：依赖文件会自动添加到上传列表中

## 分析结果说明

### 统计信息
- **原始文件**：用户最初选择的文件数量
- **找到依赖文件**：通过GUID引用找到的相关文件数量
- **找到Meta文件**：所有相关的.meta文件数量（包括原始文件和依赖文件的meta）
- **缺失依赖**：在搜索目录中找不到的GUID引用数量

### 文件分类
- **依赖文件**：通过GUID引用找到的资源文件
- **Meta文件**：所有相关的.meta文件
  - 包括原始文件对应的meta文件
  - 包括依赖文件对应的meta文件

## 技术实现

### 核心算法
1. **GUID映射建立**：扫描搜索目录中的所有.meta文件，建立GUID到文件路径的映射
2. **依赖分析**：解析每个资源文件，提取其中的GUID引用
3. **文件收集**：根据GUID映射找到对应的文件，并自动包含其meta文件
4. **去重处理**：确保同一文件不会被重复添加

### 支持的GUID格式
- YAML格式：`guid: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx`
- JSON格式：`"m_GUID": "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"`

### 过滤规则
- 跳过Unity内置资源GUID（以00000000000000开头）
- 跳过常见着色器GUID
- 跳过文件自身的GUID引用（避免循环依赖）

## 更新日志

### v1.1 (最新)
- **修复**：确保原始文件的meta文件被正确检测和添加
- **改进**：增强了对原始文件meta文件的统计和显示
- **优化**：改进了分析结果的日志输出，更清晰地显示原始文件的meta文件

### v1.0
- **新增**：基础依赖分析功能
- **新增**：自动meta文件检测
- **新增**：GUID映射和依赖链分析

## 测试验证

### 测试用例
- ✅ 模拟文件测试：使用临时创建的测试文件验证功能
- ✅ 实际文件测试：使用真实的body.prefab文件验证功能

### 验证要点
1. **原始文件meta检测**：确保body.prefab.meta被正确包含
2. **依赖文件meta检测**：确保依赖文件的meta文件被包含
3. **双向检测**：确保meta文件对应的资源文件也被包含
4. **去重处理**：确保同一文件不会被重复添加

## 常见问题

### Q: 为什么有些meta文件没有被添加？
A: 请检查：
1. meta文件是否存在于搜索目录中
2. meta文件的GUID格式是否正确
3. 对应的资源文件是否存在

### Q: 如何避免添加不必要的文件？
A: 系统会自动过滤：
1. Unity内置资源
2. 系统着色器
3. 文件自身的GUID引用

### Q: 分析结果中的"缺失依赖"是什么意思？
A: 表示在搜索目录中找不到某些GUID对应的文件，可能的原因：
1. 文件不在搜索目录中
2. 文件已被删除或移动
3. GUID引用错误

## 注意事项

1. **搜索目录设置**：确保SVN仓库路径正确设置，这是查找依赖文件的基础
2. **文件权限**：确保程序有权限读取搜索目录中的文件
3. **文件完整性**：建议在分析前确保所有相关文件都已保存
4. **网络环境**：如果SVN仓库在远程，确保网络连接正常 